<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Logistics Management System</title>

  <!-- Bootstrap CSS -->
  <link href="../bootstrap-5.3.8-dist/bootstrap-5.3.8-dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../fontawesome-free-7.1.0-web/fontawesome-free-7.1.0-web/css/all.css" />
  <link rel="stylesheet" href="css/login.css">
</head>
<body>
  <div class="login-card">
    <div class="login-header text-center">
      <div class="bg-warning rounded-circle d-inline-flex justify-content-center align-items-center" style="width:60px; height:60px;">
        <i class="fa-solid fa-truck" style="font-size:1.5rem; color:white;"></i>
      </div>
      <h5 class="mt-2">Logistics Management System</h5>
    </div>

    <form id="loginForm">
      <div class="mb-3">
        <label class="form-label">Mobile Number</label>
        <div class="input-group">
          <span class="input-group-text bg-light"><i class="fa-solid fa-user"></i></span>
          <input type="text" id="username" class="form-control" placeholder="Enter mobile number" required>
        </div>
        <div class="text-danger small mt-1" id="userError"></div>
      </div>

      <div class="mb-3">
        <label class="form-label">Password</label>
        <div class="input-group">
          <span class="input-group-text bg-light"><i class="fa-solid fa-lock"></i></span>
          <input type="password" id="password" class="form-control" placeholder="Enter password" required>
          <button class="btn btn-light" type="button" id="togglePassword">
            <i class="fa-solid fa-eye-slash text-warning"></i>
          </button>
        </div>
        <div class="text-danger small mt-1" id="passError"></div>
      </div>

      <button type="submit" class="btn btn-warning w-100 fw-bold">Sign In ‚Üí</button>
    </form>

    <p class="text-center mt-3 mb-0">
      Don‚Äôt have an account? <a href="#" class="text-warning text-decoration-none">Sign Up</a>
    </p>
  </div>

  <!-- Bootstrap JS -->
  <script src="../bootstrap-5.3.8-dist/bootstrap-5.3.8-dist/js/bootstrap.min.js"></script>

  <script>
    const form = document.getElementById('loginForm');
    const userError = document.getElementById('userError');
    const passError = document.getElementById('passError');
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');

    //  Toggle password visibility
    togglePassword.addEventListener('click', () => {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      togglePassword.innerHTML = type === 'password'
        ? '<i class="fa-solid fa-eye-slash text-warning"></i>'
        : '<i class="fa-solid fa-eye text-warning"></i>';
    });

    // Handle form submit
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      userError.textContent = '';
      passError.textContent = '';

      const mobile_no = document.getElementById('username').value.trim();
      const password = passwordInput.value.trim();

      if (!mobile_no) {
        userError.textContent = 'This field is required';
        return;
      }
      if (!password) {
        passError.textContent = 'This field is required';
        return;
      }

      try {
        // üîó Use the live PHP API
        const response = await fetch('https://www.loginlogistics.in/main/driverapp/login.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          mobile_no: mobile_no,
          password: password
        })
      });

        const data = await response.json();
        console.log('API Response:', data);

        if (data.result == 1) {
          // ‚úÖ Success
          localStorage.setItem('app_id', data.app_id);
          localStorage.setItem('mobile_no', mobile_no);

          // Redirect to dashboard
          window.location.href = 'index.html';
        } else if 
        (data.result == 0) {
          // ‚ùå Error
          passError.textContent = data.message || 'Invalid mobile number or password';
        }

      } catch (error) {
        console.error('Login error:', error);
        passError.textContent = 'Unable to connect to server. Please try again.';
      }
    });
  </script>
</body>
</html>
